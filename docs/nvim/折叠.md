在 Neovim 里「折叠」就是把一段缓冲内容收起来，只留一行标题，用来快速浏览大纲。  
下面按「折叠方式 → 开关折叠 → 常用键 → 持久化 → 小技巧」5 部分，一张速查表带走。

------------------------------------------------
一、6 种折叠方式（foldmethod）

| 名称 | 设置 | 原理 | 适合场景 |
|---|---|---|---|
| manual | `set fdm=manual` | 完全手工 `zf`/`zd` 创建/删除 | 临时、任意折叠 |
| indent | `set fdm=indent` | 按缩进层级自动折叠 | Python、YAML、Markdown |
| syntax | `set fdm=syntax` | 利用语法高亮带的 fold 区域 | C/C++、Go、Lua 等 |
| marker | `set fdm=marker` | 根据特定标记 {{{ / }}} | 日志、配置、跨语言 |
| expr   | `set fdm=expr` | 用 `foldexpr` 自定义表达式 | 最灵活，可写正则/树 |
| diff   | `set fdm=diff` | diff 模式专用，自动折叠相同行 | 对比文件时 |

**一次性设置**  
```lua
-- ~/.config/nvim/init.lua
vim.o.foldmethod = "indent"      -- 全局默认
-- 或仅当前文件类型
vim.api.nvim_create_autocmd("FileType", {
  pattern = {"python", "lua"},
  callback = function()
    vim.opt_local.foldmethod = "indent"
    vim.opt_local.foldlevel = 99   -- 默认全部展开
  end,
})
```

------------------------------------------------
二、开关折叠（manual 模式举例）

1. 创建折叠  
   `zf`{motion}   如 `zfj`（向下 2 行）、`zf%`（到配对括号）、`zf9j`（9 行）  
   在可视模式里选完按 `zf` 也行。

2. 删除折叠  
   `zd`   删除光标下的折叠定义  
   `zD`   递归删除所有嵌套折叠

3. 打开/关闭  
   `zo`   打开一层  
   `zO`   递归打开全部  
   `zc`   关闭一层  
   `zC`   递归关闭全部  
   `za`   切换当前折叠开/关  
   `zA`   递归切换

4. 移动  
   `zj`   跳到下一个折叠起点  
   `zk`   跳到上一个折叠起点  
   `[z`   跳到当前折叠开始  
   `]z`   跳到当前折叠结束

------------------------------------------------
三、一键速记图（normal 模式）

```
z f 创建   z d 删除   z o 打开   z c 关闭   z a 切换
z O C A  对应「递归」版本
z j k  [z ]z  折叠间跳转
```

------------------------------------------------
四、持久化折叠（下次打开还在）

```lua
-- 退出时保存视图（含折叠）
vim.api.nvim_create_autocmd({"BufWinLeave"}, {
  pattern = {"*"},
  callback = function()
    vim.cmd("silent! mkview")
  end,
})
-- 进入时加载视图
vim.api.nvim_create_autocmd({"BufWinEnter"}, {
  pattern = {"*"},
  callback = function()
    vim.cmd("silent! loadview")
  end,
})
```
视图默认写在 `~/.local/state/nvim/view/`（Neovim 0.9+），不用管路径。

------------------------------------------------
五、小技巧

1. 打开文件默认全部展开，只留大纲  
   `set foldlevel=99`   -- 99 层以内全展开  
   想收一点：`set foldlevel=0` 全部收起；`zM` 也能一键全收。

2. 快速增减层级  
   `zm`  减少 `foldlevel`（更收）  
   `zr`  增加 `foldlevel`（更展）

3. 状态栏显示折叠信息  
   ```lua
   -- 在 lualine 加一段
   sections = { lualine_x = {"%{foldlevel('.')}"} }
   ```

4. treesitter 折叠（0.9+ 内置）  
   ```lua
   vim.treesitter.foldexpr()   -- 比 syntax 更准
   vim.o.foldmethod = "expr"
   vim.o.foldexpr   = "v:lua.vim.treesitter.foldexpr()"
   ```

------------------------------------------------
一张图总结

```
创建  zf   删除  zd   打开  zo   关闭  zc   切换  za
递归  zO/ZC/ZA          移动  zj/zk/[z/]z
全部收起 zM  全部展开 zR   手动设层 :set foldlevel=n
```

把常用键背下来，折叠就能像开关文件夹一样顺手。
